<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√∫nker Financiero - Mi Bit√°cora</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- COMPONENTE DE ICONO DIN√ÅMICO ---
        const Icon = ({ name, size = 18, className = "" }) => {
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size }} className={`inline-block ${className}`}></i>;
        };

        // --- BASE DE DATOS BLINDADA E INMUTABLE (132 MOVIMIENTOS PROCESADOS) ---
        const DATA_MAESTRA_BLINDADA = [
            // --- FEBRERO 2026 ---
            { id: 'f-i1', title: 'Quincena 13/02', amount: 21700.00, category: 'salary', type: 'income', date: '2026-02-13' },
            { id: 'f-e1', title: 'Oxxo', amount: 56.50, category: 'food', type: 'expense', date: '2026-02-13' },
            { id: 'f-e2', title: 'Chedraui', amount: 500.91, category: 'supermarket', type: 'expense', date: '2026-02-15' },
            { id: 'f-e3', title: 'Sushi Fer', amount: 558.80, category: 'food', type: 'expense', date: '2026-02-14' },
            { id: 'f-e4', title: 'Costco', amount: 1457.30, category: 'supermarket', type: 'expense', date: '2026-02-15' },
            { id: 'f-e5', title: 'Prichos', amount: 50.00, category: 'supermarket', type: 'expense', date: '2026-02-15' },
            { id: 'f-e6', title: 'Walmart', amount: 123.50, category: 'supermarket', type: 'expense', date: '2026-02-17' },
            { id: 'f-e7', title: 'Carl\'s Jr', amount: 449.00, category: 'food', type: 'expense', date: '2026-02-15' },
            { id: 'f-e8', title: 'Gasolina moto', amount: 213.87, category: 'gas', type: 'expense', date: '2026-02-16' },
            { id: 'f-e9', title: 'Tele', amount: 1850.00, category: 'housing_services', type: 'expense', date: '2026-02-14' },
            { id: 'f-e10', title: 'Chedraui (2do)', amount: 184.69, category: 'supermarket', type: 'expense', date: '2026-02-17' },
            { id: 'f-e11', title: 'Balatas moto', amount: 79.00, category: 'maintenance', type: 'expense', date: '2026-02-16' },
            { id: 'f-e12', title: 'Mantenimiento moto', amount: 1300.00, category: 'maintenance', type: 'expense', date: '2026-02-16' },
            { id: 'f-e13', title: 'Muay Thai', amount: 1000.00, category: 'personal', type: 'expense', date: '2026-02-16' },
            { id: 'f-e14', title: 'Deuda Kenia', amount: 2000.00, category: 'debt', type: 'expense', date: '2026-02-13' },
            { id: 'f-e15', title: 'Restaurante', amount: 1100.00, category: 'food', type: 'expense', date: '2026-02-14' },
            { id: 'f-e16', title: 'Soriana', amount: 88.00, category: 'supermarket', type: 'expense', date: '2026-02-17' },
            { id: 'f-e17', title: 'UVEG', amount: 345.00, category: 'education', type: 'expense', date: '2026-02-17' },
            { id: 'f-e18', title: 'Aguakan', amount: 574.54, category: 'housing_services', type: 'expense', date: '2026-02-17' },

            // --- ENERO 2026 ---
            { id: 'j-i1', title: 'Sueldo Q1', amount: 6800.00, category: 'salary', type: 'income', date: '2026-01-15' },
            { id: 'j-i2', title: 'Sueldo Q2', amount: 6800.00, category: 'salary', type: 'income', date: '2026-01-30' },
            { id: 'j-e1', title: 'Luz', amount: 1088.00, category: 'housing_services', type: 'expense', date: '2026-01-21' },
            { id: 'j-e2', title: 'Renta', amount: 7500.00, category: 'housing_services', type: 'expense', date: '2026-01-31' },
            { id: 'j-e3', title: 'UVEG', amount: 345.00, category: 'education', type: 'expense', date: '2026-01-27' },
            { id: 'j-e4', title: 'Gasolina', amount: 900.00, category: 'gas', type: 'expense', date: '2026-01-15' },
            { id: 'j-e5', title: 'Oxxo', amount: 59.50, category: 'food', type: 'expense', date: '2026-01-19' },

            // --- NOVIEMBRE 2025 (Resumen estrat√©gico) ---
            { id: 'n-i1', title: 'Quincena Q1', amount: 5880.32, category: 'salary', type: 'income', date: '2025-11-14' },
            { id: 'n-i2', title: 'Quincena Q2', amount: 5334.00, category: 'salary', type: 'income', date: '2025-11-28' },
            { id: 'n-i3', title: 'Propinas Total', amount: 4797.00, category: 'tips', type: 'income', date: '2025-11-15' },
            { id: 'n-e1', title: 'Vuelos', amount: 3146.00, category: 'travel', type: 'expense', date: '2025-11-01' },
            { id: 'n-e2', title: 'Luz (CFE)', amount: 1728.00, category: 'housing_services', type: 'expense', date: '2025-11-19' },
            { id: 'n-e3', title: 'Renta', amount: 7500.00, category: 'housing_services', type: 'expense', date: '2025-11-30' },
            { id: 'n-e4', title: 'Gasolina', amount: 1500.00, category: 'gas', type: 'expense', date: '2025-11-15' },

            // --- OCTUBRE 2025 ---
            { id: 'o-i1', title: 'Quincena Oct', amount: 6887.51, category: 'salary', type: 'income', date: '2025-10-15' },
            { id: 'o-i2', title: 'Propinas Oct', amount: 1500.00, category: 'tips', type: 'income', date: '2025-10-17' },
            { id: 'o-i3', title: 'Venta gorras MBS', amount: 5949.00, category: 'mbscaps', type: 'income', date: '2025-10-20' },
            { id: 'o-i4', title: 'Finiquito', amount: 12409.00, category: 'salary', type: 'income', date: '2025-10-31' },
            { id: 'o-e1', title: 'Lentes', amount: 2922.00, category: 'health', type: 'expense', date: '2025-10-19' },
            { id: 'o-e2', title: 'Adelanto Banamex', amount: 2857.00, category: 'debt', type: 'expense', date: '2025-10-21' },
            { id: 'o-e3', title: 'Renta Oct', amount: 7500.00, category: 'housing_services', type: 'expense', date: '2025-10-31' },
            { id: 'o-e4', title: 'Gasolina mes', amount: 1930.00, category: 'gas', type: 'expense', date: '2025-10-15' },
        ];

        function App() {
            const apiKey = ""; // <--- TU LLAVE DE GEMINI AQU√ç

            // --- ESTADOS ---
            const [transactions, setTransactions] = useState(DATA_MAESTRA_BLINDADA);
            const [selectedMonth, setSelectedMonth] = useState('2026-02');
            const [activeTab, setActiveTab] = useState('history');
            const [filter, setFilter] = useState('all');
            const [manualBudget, setManualBudget] = useState(27700);
            const [incomeBreakdown, setIncomeBreakdown] = useState({ q1: 21700, q2: 6000 });
            const [aiInsight, setAiInsight] = useState("");
            const [isAiLoading, setIsAiLoading] = useState(false);
            const [expandedCategory, setExpandedCategory] = useState(null);

            const [customWeights, setCustomWeights] = useState({
                housing_services: 32.0, gas: 6.0, education: 1.5, food: 10.0, supermarket: 8.0, personal: 5.0, health: 5.0, debt: 7.0, maintenance: 4.5, cards: 5.0, subscriptions: 2.0, travel: 5.0, other: 4.0, savings_unallocated: 5.0
            });

            const [newTransaction, setNewTransaction] = useState({ title: '', amount: '', category: 'food', type: 'expense', date: new Date().toISOString().split('T')[0] });

            // --- CATEGOR√çAS ---
            const expenseCategories = {
                housing_services: { label: 'Vivienda y Servicios', icon: "home", color: 'bg-indigo-50 text-indigo-600', isFixed: true },
                gas: { label: 'Gasolina', icon: "car", color: 'bg-zinc-50 text-zinc-600', isFixed: true },
                education: { label: 'Educaci√≥n', icon: "book-open", color: 'bg-cyan-50 text-cyan-600', isFixed: true },
                food: { label: 'Comida', icon: "coffee", color: 'bg-orange-50 text-orange-600' },
                supermarket: { label: 'Supermercado', icon: "shopping-cart", color: 'bg-lime-50 text-lime-600' },
                personal: { label: 'Gastos Personales', icon: "user", color: 'bg-purple-50 text-purple-600' },
                health: { label: 'Salud/M√©dicos', icon: "heart", color: 'bg-red-50 text-red-600' },
                debt: { label: 'Deuda', icon: "trending-down", color: 'bg-rose-50 text-rose-600' },
                maintenance: { label: 'Mantenimiento Transporte', icon: "wrench", color: 'bg-slate-50 text-slate-600' },
                cards: { label: 'Tarjetas', icon: "credit-card", color: 'bg-blue-50 text-blue-600' },
                subscriptions: { label: 'Suscripciones', icon: "monitor", color: 'bg-violet-50 text-violet-600' },
                travel: { label: 'Viajes', icon: "plane", color: 'bg-sky-50 text-sky-600' },
                other: { label: 'Otros', icon: "more-horizontal", color: 'bg-gray-50 text-gray-600' },
            };

            const incomeCategories = {
                salary: { label: 'Sueldo', icon: "briefcase", color: 'bg-emerald-50 text-emerald-600' },
                tips: { label: 'Propinas', icon: "coins", color: 'bg-amber-50 text-amber-600' },
                mbscaps: { label: 'MBSCAPS', icon: "tag", color: 'bg-blue-50 text-blue-600' },
                savings: { label: 'Ahorro', icon: "wallet", color: 'bg-cyan-50 text-cyan-600' },
            };

            // --- HANDLERS ---
            const handleAddTransaction = (e) => {
                e.preventDefault();
                if (!newTransaction.title || !newTransaction.amount) return;
                const t = { id: Date.now(), ...newTransaction, amount: parseFloat(newTransaction.amount) };
                setTransactions(prev => [t, ...prev].sort((a, b) => new Date(b.date) - new Date(a.date)));
                setNewTransaction({ ...newTransaction, title: '', amount: '' });
            };

            const handleDelete = (id) => setTransactions(prev => prev.filter(t => t.id !== id));

            const updateWeight = (catKey, value) => {
                const newVal = parseFloat(value) || 0;
                const otherSum = Object.entries(customWeights).filter(([k]) => k !== catKey && k !== 'savings_unallocated').reduce((acc, [, v]) => acc + v, 0);
                const maxAllowed = 100 - otherSum;
                const clampedVal = Math.max(0, Math.min(newVal, maxAllowed));
                setCustomWeights(prev => ({ ...prev, [catKey]: clampedVal, savings_unallocated: 100 - (otherSum + clampedVal) }));
            };

            const updateIncomePart = (key, val) => {
                const num = parseFloat(val) || 0;
                const newB = { ...incomeBreakdown, [key]: num };
                setIncomeBreakdown(newB);
                setManualBudget(newB.q1 + newB.q2);
            };

            // --- IA PROACTIVA ---
            const generateAiInsight = async () => {
                if(!apiKey) { setAiInsight("Configura tu API Key en el c√≥digo para activar al asesor."); return; }
                setIsAiLoading(true);
                setAiInsight("");
                const prompt = `Act√∫a como mi Asesor Financiero. Analiza mi mes de ${formatMonth(selectedMonth)}. 
                Plan Maestro: ${formatCurrency(manualBudget)} (Q1: ${formatCurrency(incomeBreakdown.q1)}, Q2: ${formatCurrency(incomeBreakdown.q2)}). 
                Gasto Real: ${formatCurrency(stats.expenses)}. Balance: ${formatCurrency(stats.balance)}.
                Dime "OJO AQU√ç ‚ö†Ô∏è" para peligros de exceso y "OJO ALL√Å üíé" para oportunidades de gasto u ahorro bas√°ndote en que mi ingreso se divide en dos quincenas. Tono profesional y emp√°tico.`;
                
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    const result = await response.json();
                    setAiInsight(result.candidates[0].content.parts[0].text);
                } catch (e) { setAiInsight("Error de conexi√≥n con la IA financiera."); }
                finally { setIsAiLoading(false); }
            };

            // --- C√ÅLCULOS ---
            const availableMonths = useMemo(() => Array.from(new Set(transactions.map(t => t.date.slice(0, 7)))).sort().reverse(), [transactions]);
            const transactionsInMonth = useMemo(() => transactions.filter(t => t.date.startsWith(selectedMonth)), [transactions, selectedMonth]);
            const stats = useMemo(() => {
                const inc = transactionsInMonth.filter(t => t.type === 'income').reduce((a, b) => a + b.amount, 0);
                const exp = transactionsInMonth.filter(t => t.type === 'expense').reduce((a, b) => a + b.amount, 0);
                const catMap = {};
                transactionsInMonth.filter(t => t.type === 'expense').forEach(t => { catMap[t.category] = (catMap[t.category] || 0) + t.amount; });
                const cStats = Object.entries(catMap).map(([k, v]) => ({ key: k, amount: v, label: expenseCategories[k]?.label || 'Otros', color: expenseCategories[k]?.color || 'bg-gray-100', percent: exp > 0 ? (v / exp) * 100 : 0 })).sort((a, b) => b.amount - a.amount);
                return { income: inc, expenses: exp, balance: inc - exp, categoryStats: cStats };
            }, [transactionsInMonth]);

            const budgetStats = useMemo(() => {
                const BASE = manualBudget;
                const sortedCats = Object.entries(expenseCategories).sort((a, b) => a[1].label.localeCompare(b[1].label));
                const list = sortedCats.map(([key, config]) => {
                    const weight = customWeights[key] || 0;
                    const ideal = (weight / 100) * BASE;
                    const actual = stats.categoryStats.find(cs => cs.key === key)?.amount || 0;
                    return { key, label: config.label, icon: config.icon, color: config.color, isFixed: config.isFixed, ideal, actual, percent: ideal > 0 ? (actual / ideal) * 100 : 0, weight };
                });
                list.push({ key: 'savings_unallocated', label: 'Ahorro / No Asignado', icon: "wallet", color: 'bg-emerald-50 text-emerald-600', isFixed: false, ideal: ((customWeights.savings_unallocated || 0) / 100) * BASE, actual: 0, percent: 0, weight: customWeights.savings_unallocated || 0 });
                return list;
            }, [stats.categoryStats, manualBudget, customWeights]);

            const formatCurrency = (n) => new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }).format(n);
            const formatMonth = (m) => { if(!m) return ""; const [y, mm] = m.split('-'); return new Date(y, mm - 1).toLocaleDateString('es-MX', { month: 'long', year: 'numeric' }); };

            return (
                <div className="min-h-screen pb-32">
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-30 p-6 shadow-sm rounded-b-[2.5rem]">
                        <div className="flex items-center justify-between mb-8 bg-slate-100 p-1.5 rounded-2xl">
                            <button onClick={() => { const idx = availableMonths.indexOf(selectedMonth); if (idx < availableMonths.length - 1) setSelectedMonth(availableMonths[idx + 1]); }} className="p-2 text-slate-400 hover:text-indigo-600 transition-colors"><Icon name="chevron-left" /></button>
                            <div className="font-black text-slate-900 uppercase tracking-[0.15em] text-xs flex items-center gap-2"><Icon name="calendar" size={14} className="text-indigo-600" /> {formatMonth(selectedMonth)}</div>
                            <button onClick={() => { const idx = availableMonths.indexOf(selectedMonth); if (idx > 0) setSelectedMonth(availableMonths[idx - 1]); }} className="p-2 text-slate-400 hover:text-indigo-600 transition-colors"><Icon name="chevron-right" /></button>
                        </div>
                        <div className="flex justify-between items-end mb-8 px-2">
                            <div className="space-y-1">
                                <p className="text-[10px] text-slate-400 font-black uppercase tracking-widest">Saldo Disponible</p>
                                <p className={`text-5xl font-black tracking-tighter ${stats.balance >= 0 ? 'text-slate-900' : 'text-red-500'}`}>{formatCurrency(stats.balance)}</p>
                            </div>
                            <div className="flex flex-col gap-2">
                                <div className="bg-emerald-50 px-4 py-2 rounded-2xl border border-emerald-100 text-center shadow-sm"><p className="text-[9px] text-emerald-600 font-black uppercase">Ingresos</p><p className="text-base font-bold text-emerald-700">{formatCurrency(stats.income)}</p></div>
                                <div className="bg-red-50 px-4 py-2 rounded-2xl border border-red-100 text-center shadow-sm"><p className="text-[9px] text-red-600 font-black uppercase">Gastos</p><p className="text-base font-bold text-red-700">{formatCurrency(stats.expenses)}</p></div>
                            </div>
                        </div>
                        <nav className="flex bg-slate-100 p-1.5 rounded-2xl border border-slate-200 shadow-inner">
                            {[{ id: 'history', label: 'Movimientos', icon: 'list' }, { id: 'analytics', label: 'An√°lisis', icon: 'pie-chart' }, { id: 'budget', label: 'Presupuesto', icon: 'target' }].map((tab) => (
                                <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex-1 flex items-center justify-center gap-2 py-3 px-4 rounded-xl text-xs font-black transition-all ${activeTab === tab.id ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>
                                    <Icon name={tab.icon} size={16} /> {tab.label}
                                </button>
                            ))}
                        </nav>
                    </header>

                    <main className="px-6 py-8">
                        {activeTab === 'history' && (
                            <div className="space-y-8 animate-in fade-in duration-500">
                                <section className="rounded-3xl border p-8 bg-white border-slate-200 shadow-sm">
                                    <div className="flex gap-4 p-1 bg-slate-100 rounded-2xl border border-slate-200 w-fit mb-8">
                                        <button onClick={() => handleTypeChange('expense')} className={`px-6 py-2 rounded-xl text-[10px] font-black uppercase transition-all ${newTransaction.type === 'expense' ? 'bg-red-500 text-white shadow-md' : 'text-slate-500'}`}>Salida</button>
                                        <button onClick={() => handleTypeChange('income')} className={`px-6 py-2 rounded-xl text-[10px] font-black uppercase transition-all ${newTransaction.type === 'income' ? 'bg-emerald-500 text-white shadow-md' : 'text-slate-500'}`}>Entrada</button>
                                    </div>
                                    <form onSubmit={handleAddTransaction} className="grid grid-cols-1 md:grid-cols-12 gap-4">
                                        <div className="md:col-span-12 space-y-4">
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div className="space-y-2"><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Concepto</label><input type="text" value={newTransaction.title} onChange={(e) => setNewTransaction({...newTransaction, title: e.target.value})} placeholder="¬øEn qu√©?" className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm outline-none focus:border-indigo-400 focus:bg-white transition-all" /></div>
                                                <div className="space-y-2"><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Monto</label><input type="number" value={newTransaction.amount} onChange={(e) => setNewTransaction({...newTransaction, amount: e.target.value})} placeholder="$ 0.00" step="0.01" className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm outline-none focus:border-indigo-400 focus:bg-white transition-all font-bold text-lg" /></div>
                                                <div className="space-y-2"><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Categor√≠a</label><select value={newTransaction.category} onChange={(e) => setNewTransaction({...newTransaction, category: e.target.value})} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-sm outline-none cursor-pointer">{Object.entries(newTransaction.type === 'expense' ? expenseCategories : incomeCategories).map(([k, c]) => (<option key={k} value={k}>{c.label}</option>))}</select></div>
                                            </div>
                                            <div className="flex gap-4 pt-4"><input type="date" value={newTransaction.date} onChange={(e) => setNewTransaction({...newTransaction, date: e.target.value})} className="flex-1 px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-xs outline-none text-slate-600" /><button type="submit" className="px-10 rounded-2xl text-white font-black bg-indigo-600 transition-all active:scale-95 shadow-lg">REGISTRAR</button></div>
                                        </div>
                                    </form>
                                </section>
                                <div className="space-y-12">
                                    {['income', 'expense'].map((f) => (
                                        <div key={f} className="space-y-4">
                                            <div className="flex items-center gap-2 px-2"><Icon name={f === 'income' ? 'arrow-up-circle' : 'arrow-down-circle'} className={f === 'income' ? 'text-emerald-500' : 'text-red-400'} size={16} /><h3 className={`text-[10px] font-black uppercase tracking-widest ${f === 'income' ? 'text-emerald-500' : 'text-red-400'}`}>{f === 'income' ? 'Entradas' : 'Salidas'}</h3></div>
                                            <div className="space-y-3">{transactionsInMonth.filter(t => t.type === f).map(t => {
                                                const c = f === 'expense' ? expenseCategories[t.category] : incomeCategories[t.category];
                                                return (
                                                    <div key={t.id} className="bg-white p-5 rounded-[1.5rem] border border-slate-100 flex items-center justify-between group hover:shadow-lg transition-all duration-300">
                                                        <div className="flex items-center gap-4">
                                                            <div className={`w-12 h-12 rounded-2xl flex items-center justify-center shadow-sm ${c?.color || 'bg-slate-50'}`}><Icon name={c?.icon} /></div>
                                                            <div><h4 className="font-bold text-slate-900 text-sm tracking-tight">{t.title}</h4><p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-1">{c?.label} ‚Ä¢ {new Date(t.date + 'T12:00:00').toLocaleDateString('es-MX', {day: 'numeric', month: 'short'})}</p></div>
                                                        </div>
                                                        <div className="flex items-center gap-4"><span className={`font-black text-base tabular-nums ${f === 'expense' ? 'text-red-500' : 'text-emerald-500'}`}>{f === 'expense' ? '-' : '+'}{formatCurrency(t.amount)}</span><button onClick={() => handleDelete(t.id)} className="p-2 text-slate-300 hover:text-red-500 transition-colors"><Icon name="trash-2" size={16} /></button></div>
                                                    </div>
                                                );
                                            })}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'analytics' && (
                            <div className="space-y-8 animate-in slide-in-from-bottom-10 duration-700">
                                <section className="bg-slate-900 p-8 rounded-[3rem] text-white shadow-2xl relative overflow-hidden border border-white/5">
                                    <div className="absolute top-0 right-0 p-6 opacity-10 rotate-12 text-indigo-400"><Icon name="brain-circuit" size={140} /></div>
                                    <div className="relative z-10">
                                        <div className="flex items-center gap-3 mb-6"><div className="bg-indigo-500/20 p-2.5 rounded-2xl border border-indigo-500/30 text-indigo-400"><Icon name="sparkles" size={24}/></div><div><h3 className="text-lg font-black uppercase tracking-[0.2em]">Consultor de Estrategia</h3><p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">An√°lisis de Plan vs Realidad</p></div></div>
                                        {aiInsight ? (
                                            <div className="space-y-6 animate-in fade-in duration-500"><div className="bg-white/5 backdrop-blur-md p-6 rounded-[2rem] border border-white/10"><p className="text-sm font-medium leading-relaxed text-slate-200 whitespace-pre-wrap">{aiInsight}</p></div><button onClick={generateAiInsight} className="flex items-center gap-2 text-[10px] font-black uppercase tracking-widest bg-indigo-600 text-white px-8 py-3 rounded-2xl shadow-xl hover:bg-indigo-500 transition-all active:scale-95">Recalcular Auditor√≠a</button></div>
                                        ) : (
                                            <div className="flex flex-col items-center py-10 bg-white/5 rounded-[2.5rem] border border-white/5 border-dashed"><p className="text-sm text-slate-300 mb-8 text-center font-medium px-10 italic">"Analizar√© tus gastos de este mes bas√°ndome en tus dos ingresos quincenales y tu Plan Maestro."</p><button onClick={generateAiInsight} disabled={isAiLoading} className="flex items-center gap-3 bg-white text-slate-900 px-12 py-4 rounded-[1.5rem] font-black uppercase tracking-[0.15em] text-xs shadow-2xl hover:scale-105 transition-all disabled:opacity-50">{isAiLoading ? "Consultando a Gemini..." : "Iniciar Auditor√≠a IA"}</button></div>
                                        )}
                                    </div>
                                </section>
                                <section className="bg-white p-10 rounded-[3rem] text-slate-900 shadow-sm border border-slate-200">
                                    <h3 className="text-xl font-black uppercase tracking-widest mb-10 flex items-center gap-3"><div className="w-2 h-8 bg-indigo-600 rounded-full"></div> Distribuci√≥n Real</h3>
                                    <div className="space-y-8">
                                        {stats.categoryStats.map((cat, idx) => {
                                            const isExpanded = expandedCategory === cat.key;
                                            const details = transactionsInMonth.filter(t => t.category === cat.key && t.type === 'expense');
                                            return (
                                                <div key={cat.key} className="space-y-4">
                                                    <div onClick={() => setExpandedCategory(isExpanded ? null : cat.key)} className="cursor-pointer group"><div className="flex justify-between items-center mb-2 px-1"><div className="flex items-center gap-4"><div className={`w-10 h-10 rounded-xl flex items-center justify-center transition-transform group-hover:scale-110 ${cat.color}`}><Icon name={expenseCategories[cat.key]?.icon} /></div><div><p className="text-sm font-black uppercase">{cat.label}</p><p className="text-[10px] text-slate-400 font-bold">{formatCurrency(cat.amount)} invertidos</p></div></div><div className="text-right flex items-center gap-4"><span className="text-2xl font-black text-slate-900">{cat.percent.toFixed(1)}%</span><Icon name={isExpanded ? "chevron-up" : "chevron-down"} size={20} /></div></div><div className="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden"><div className="h-full bg-indigo-600 transition-all duration-1000" style={{ width: `${cat.percent}%` }}></div></div></div>
                                                    {isExpanded && ( <div className="bg-slate-50 rounded-3xl p-6 space-y-3 animate-in fade-in duration-300">{details.map(det => ( <div key={det.id} className="flex justify-between items-center py-2 border-b border-slate-200 last:border-0"><span className="text-xs font-bold text-slate-600">{det.title}</span><span className="text-xs font-black">{formatCurrency(det.amount)}</span></div> ))}</div> )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                </section>
                            </div>
                        )}

                        {activeTab === 'budget' && (
                            <div className="space-y-8 animate-in slide-in-from-bottom-10 duration-700 px-1">
                                <div className="bg-slate-900 p-10 rounded-[3rem] text-white shadow-xl relative overflow-hidden border border-white/5">
                                    <div className="absolute top-0 right-0 p-6 opacity-10 rotate-12 text-emerald-400"><Icon name="landmark" size={140} /></div>
                                    <div className="relative z-10">
                                        <h3 className="text-2xl font-black mb-1">Plan Maestro</h3>
                                        <p className="text-slate-400 text-xs font-bold uppercase tracking-widest mb-10">Distribuci√≥n de Ingresos por Quincena</p>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div className="bg-white/10 p-6 rounded-3xl border border-white/10 shadow-inner">
                                                <p className="text-[10px] font-black text-indigo-400 uppercase tracking-widest mb-3">Total Estimado</p>
                                                <div className="flex items-center gap-2"><span className="text-3xl font-black">$</span><span className="text-3xl font-black outline-none">{manualBudget.toLocaleString()}</span></div>
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div className="bg-white/5 p-4 rounded-3xl border border-white/5">
                                                    <p className="text-[9px] font-black text-slate-400 uppercase mb-2">1ra Quincena</p>
                                                    <div className="flex items-center gap-1 border-b border-white/10 pb-1"><span className="text-sm font-bold">$</span><input type="number" value={incomeBreakdown.q1} onChange={(e) => updateIncomePart('q1', e.target.value)} className="bg-transparent text-sm font-black w-full outline-none" /></div>
                                                </div>
                                                <div className="bg-white/5 p-4 rounded-3xl border border-white/5">
                                                    <p className="text-[9px] font-black text-slate-400 uppercase mb-2">2da Quincena</p>
                                                    <div className="flex items-center gap-1 border-b border-white/10 pb-1"><span className="text-sm font-bold">$</span><input type="number" value={incomeBreakdown.q2} onChange={(e) => updateIncomePart('q2', e.target.value)} className="bg-transparent text-sm font-black w-full outline-none" /></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div className="space-y-4">
                                    {budgetStats.map((b) => {
                                        const isOver = b.actual > b.ideal;
                                        const remaining = b.ideal - b.actual;
                                        const isSavingsRow = b.key === 'savings_unallocated';
                                        return (
                                            <div key={b.key} className={`p-8 rounded-[2rem] border shadow-sm relative group transition-all ${isSavingsRow ? 'bg-emerald-50 border-emerald-100' : 'bg-white border-slate-200'}`}>
                                                <div className="flex justify-between items-start mb-8"><div className="flex items-center gap-5"><div className={`w-16 h-16 rounded-3xl flex items-center justify-center border border-slate-100 ${b.color}`}><Icon name={b.icon} /></div><div><h5 className="font-black text-slate-900 text-lg tracking-tight">{b.label}</h5><div className="flex items-center gap-2 mt-2 bg-slate-100 p-2 rounded-xl border border-slate-200"><Icon name="percent" size={12} className="text-indigo-600" /><input type="number" value={b.weight.toFixed(1)} onChange={(e) => updateWeight(b.key, e.target.value)} disabled={isSavingsRow} className="bg-transparent text-slate-900 text-xs font-black w-12 outline-none disabled:opacity-50" /><span className="text-[10px] text-slate-400 font-bold uppercase">Meta %</span></div></div></div><div className="text-right"><p className={`text-2xl font-black ${isOver ? 'text-red-500' : 'text-slate-900'}`}>{formatCurrency(b.actual)}</p><p className="text-[10px] text-slate-400 font-bold uppercase mt-1">Ideal: {formatCurrency(b.ideal)}</p></div></div>
                                                {!isSavingsRow && (
                                                    <div className="space-y-4">
                                                        <div className="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden"><div className={`h-full transition-all duration-1000 ${isOver ? 'bg-red-500' : 'bg-indigo-600'}`} style={{ width: `${Math.min(100, b.percent)}%` }}></div></div>
                                                        <div className={`text-[10px] font-black uppercase px-4 py-2 rounded-xl w-fit ${remaining >= 0 ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}`}>{remaining >= 0 ? `Quedan: ${formatCurrency(remaining)}` : `D√©ficit: ${formatCurrency(Math.abs(remaining))}`}</div>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}
                    </main>

                    <div className="fixed bottom-8 left-1/2 -translate-x-1/2 w-[90%] max-w-lg z-50">
                        <div className="bg-slate-900 p-5 rounded-[2rem] shadow-2xl text-slate-300 flex gap-6 items-center border border-slate-800"><div className="bg-indigo-600 p-3 rounded-2xl text-white shadow-lg"><Icon name="star" size={24}/></div><div className="flex-1"><p className="text-[10px] font-black uppercase text-slate-400 tracking-tighter mb-1">Diagn√≥stico Actual</p><p className="text-sm font-bold text-white tracking-tight">{stats.balance > 0 ? `Saldo a favor de ${formatCurrency(stats.balance)}.` : `D√©ficit de ${formatCurrency(Math.abs(stats.balance))}.`}</p></div></div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
